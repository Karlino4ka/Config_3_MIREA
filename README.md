Вариант №25

Задание №3 

Разработать инструмент командной строки для учебного конфигурационного 
языка, синтаксис которого приведен далее. Этот инструмент преобразует текст из 
входного формата в выходной. Синтаксические ошибки выявляются с выдачей 
сообщений. 

Входной текст на учебном конфигурационном языке принимается из 
файла, путь к которому задан ключом командной строки. Выходной текст на 
языке yaml попадает в стандартный вывод.

Однострочные комментарии: 
*> Это однострочный комментарий 

Словари: 
struct {
имя = значение, 
имя = значение, 
имя = значение, 
... 
} 

Имена: 
[a-z]+ 

Значения: 
• Числа. 
• Строки. 
• Словари. 

Строки: 
'Это строка' 

Объявление константы на этапе трансляции: 
имя <- значение; 

Вычисление константного выражения на этапе трансляции (постфиксная 
форма), пример: 
$имя 1 +$ 

Результатом вычисления константного выражения является значение. 
Для константных вычислений определены операции и функции: 
1. Сложение. 
2. Вычитание. 
3. min(). 
4. mod().
   
Все конструкции учебного конфигурационного языка (с учетом их 
возможной вложенности) должны быть покрыты тестами.





Класс ConfigParser
Основной класс для обработки пользовательского конфигурационного языка и преобразования его в словарь Python.

__init__(self)
Инициализация объекта класса.
Описание: Создает пустой словарь self.constants для хранения констант.
Аргументы: self — ссылка на текущий экземпляр класса.
Возвращаемое значение: Ничего не возвращает.

parse(self, text: str) -> Dict[str, Any]
Парсит входной текст и возвращает словарь, представляющий данные.
Аргументы: text (str): Входной текст на пользовательском конфигурационном языке.
Возвращаемое значение: Dict[str, Any]: Словарь с обработанными данными, включая константы и структуры.
Описание работы: Разделяет текст на строки и обрабатывает их по одной. Игнорирует пустые строки и комментарии.
Вызывает _parse_constant для обработки строк с константами.
Вызывает _parse_struct для обработки строк, начинающихся с struct.

_parse_constant(self, line: str)
Обрабатывает строку с объявлением константы и добавляет её в self.constants.
Аргументы: line (str): Строка с объявлением константы.
Возвращаемое значение: Ничего не возвращает.
Описание работы: Ищет соответствие строки формату имя <- значение; с помощью регулярного выражения.
Вызывает _evaluate_expression для вычисления значения.
Сохраняет имя и вычисленное значение в словарь self.constants.

_evaluate_expression(self, expr: str) -> Union[int, str] Вычисляет выражение и возвращает результат.
Аргументы: expr (str): Выражение для вычисления.
Возвращаемое значение: Union[int, str]: Результат вычисления (число или строка).
Описание работы: Проверяет, является ли выражение окруженным $.
Если да, разбивает его на токены и выполняет вычисления.
Возвращает числовые значения или строки.
Поддерживает базовые операции (+, -, min, mod) и использование констант.

_parse_struct(self, lines, start_index: int) -> (str, Dict[str, Any], int) Обрабатывает структуру и возвращает её имя, содержимое и количество обработанных строк.
Аргументы: lines (list[str]): Список строк входного текста.
start_index (int): Индекс строки, с которой начинается структура.
Возвращаемое значение:(str, Dict[str, Any], int):
Имя структуры,
Словарь с ключами и значениями из структуры,
Количество строк, использованных для обработки структуры.
Описание работы: Проверяет, начинается ли строка с struct и соответствует ли синтаксису с помощью регулярного выражения.
Считывает строки структуры, пока не встретит закрывающую скобку }.
Разбирает строки внутри структуры:
Ищет пары ключ = значение,.
Вычисляет значение через _evaluate_expression.

Функция main() Основная точка входа в программу.
Описание работы: Создает и настраивает парсер аргументов командной строки.
Считывает входной файл, указанный пользователем.
Вызывает метод parse объекта ConfigParser для обработки текста.
Выводит результат в формате YAML.
Обрабатывает исключения SyntaxError и ValueError, выводя ошибки в консоль.

Пример входных данных

![image](https://github.com/user-attachments/assets/8e60f9f9-f063-4ffd-bd99-c29169623959)

Вывод

![image](https://github.com/user-attachments/assets/51ef3094-9950-451d-8906-7aeec28dc240)

Тесты

![image](https://github.com/user-attachments/assets/705a18c6-245f-4444-a175-1a1fb429007c)



